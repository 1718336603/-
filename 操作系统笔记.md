## 操作系统干了什么？

在执行一个简单的hello world程序的时候操作系统干了些什么

```c
#include<stdio.h>
int main(int argc,char argv[]){
    puts("hello world");
    return 0;
}
```

* 首先用户告知操作系统执行那个可执行文件（双击，cmd等）
* 操作系统在磁盘上找到该文件的地址查看是否是可执行文件，然后计算出代码记数据在磁盘中的位置
* 为了执行这个文件会新建一个进程，将执行文件映射到该进程的结构中
* 然后由调度程序去设置CPU的上下文来并在下一个时钟周期跳到hello world的开始处开始执行（假设调度程序选中hello world程序去执行）
* 在执行程序的第一条指令发生缺叶报错（假设内存管理方案为页式）
* 操作系统会为程序分配一页空闲的物理内存页并将代码和数据读入内存
* 程序调用函数puts(系统调用)，在显示器上显示一个字符串
* 操作系统找到对应输出设备，一般这个设备是由一个程序控制，所以需要把数据交给这个进程
* 然后由该进程判断操作是否合法并将数据进行转换成像素写入硬件
* 硬件将像素，改为机器可以执行的命令
* 显示器解释命令，显示hello world

## 操作系统的主要作用

* 资源管理
* 通过各种系统函数对用户软件起到支持的作用
* 屏蔽硬件的复杂性



## 操作系统的主要特征

* 并发（多个程序共同运行 ，增加资源利用率）
* 共享（保证进程的通信）
* 虚拟（分配虚拟内存，增加资源的利用率）
* 随机（由于通过cpu调度，cpu的状态难以重现）

## 操作系统典型架构

操作系统非**用户态**与**内核态**

#### windows架构

内核态

* 硬件抽象层（与具体硬件交互）
* 内核层（主要功能 如线程调度，异常处理，同步）
* 设备驱动层（驱动设备的程序）
* 图形窗口层（windows特有）
* 执行体（支持各种各样的功能，并提供系统函数供用户去使用）
* 系统服务分发器（通过与动态连接库连接对用户态服务提供各种各样的支持）

用户态

* 系统进程
* 服务进程
* 用户进程
* 环境子系统
* 动态链接库

#### UNIX架构

内核态：

* 进程控制的子系统（存储管理，通信，调度）
* 文件系统
* 设备驱动程序
  * 块设备驱动
  * 字符设备驱动
* 硬件控制层
* 系统调用接口

#### Linux架构

内核态：

* 进程调度
* 虚拟内存管理
* 物理内存管理
* 文件系统
* 设备驱动程序
  * 块设备驱动
  * 字符设备驱动
* 网络体结构
* 陷入处理
* 异常处理
* 系统调用